/*
 * jQuery Mobile Framework : plugin to provide a number spinner.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-spinbox
 */
(function(a){a.widget("mobile.spinbox",a.mobile.widget,{options:{dmin:false,dmax:false,step:false,theme:false,repButton:true,version:"1.4.3-2014080200",initSelector:"input[data-role='spinbox']",clickEvent:"vclick",type:"horizontal",},_sbox_run:function(){var b=this,c=150;if(b.g.cnt>10){c=100}if(b.g.cnt>30){c=50}if(b.g.cnt>60){c=20}b.g.didRun=true;b._offset(this,b.g.delta);b.g.cnt++;b.runButton=setTimeout(function(){b._sbox_run()},c)},_offset:function(d,c){var b=this,e=this.options;if(!b.disabled){if(c<1){tmp=parseInt(b.d.input.val(),10)-e.step;if(tmp>=e.dmin){b.d.input.val(tmp);b.d.input.trigger("change")}}else{tmp=parseInt(b.d.input.val(),10)+e.step;if(tmp<=e.dmax){b.d.input.val(tmp);b.d.input.trigger("change")}}}},_create:function(){var b=this,c,f,h=a.extend(this.options,this.element.jqmData("options")),g={input:this.element,inputWrap:this.element.parent()},i=(typeof window.ontouchstart!=="undefined"),e={eStart:(i?"touchstart":"mousedown")+".spinbox",eMove:(i?"touchmove":"mousemove")+".spinbox",eEnd:(i?"touchend":"mouseup")+".spinbox",eEndA:(i?"mouseup.spinbox touchend.spinbox touchcancel.spinbox touchmove.spinbox":"mouseup.spinbox"),move:false,start:false,end:false,pos:false,target:false,delta:false,tmp:false,cnt:0};b.d=g;b.g=e;if(h.theme===false){h.theme=a(this).closest("[data-theme]").attr("data-theme");if(typeof h.theme==="undefined"){h.theme="a"}}if(h.dmin===false){h.dmin=(typeof b.d.input.attr("min")!=="undefined")?parseInt(b.d.input.attr("min"),10):Number.MAX_VALUE*-1}if(h.dmax===false){h.dmax=(typeof b.d.input.attr("max")!=="undefined")?parseInt(b.d.input.attr("max"),10):Number.MAX_VALUE}if(h.step===false){h.step=(typeof b.d.input.attr("step")!=="undefined")?parseInt(b.d.input.attr("step"),10):1}f=(b.d.input.jqmData("mini")===true);b.d.wrap=a("<div>",{"data-role":"controlgroup","data-type":h.type,"data-mini":f,"data-theme":h.theme}).insertBefore(b.d.inputWrap).append(b.d.inputWrap);b.d.inputWrap.addClass("ui-btn");b.d.input.css({textAlign:"center"});if(h.type==="horizontal"){b.d.inputWrap.css({padding:f?"1px 0":"4px 0 3px"});b.d.input.css({width:f?"40px":"50px"})}else{b.d.wrap.css({width:"auto"});b.d.inputWrap.css({padding:0})}b.d.up=a("<div>",{"class":"ui-btn ui-icon-plus ui-btn-icon-notext"}).html("&nbsp;");b.d.down=a("<div>",{"class":"ui-btn ui-icon-minus ui-btn-icon-notext"}).html("&nbsp;");if(h.type==="horizontal"){b.d.down.prependTo(b.d.wrap);b.d.up.appendTo(b.d.wrap);b.d.down.addClass("ui-last-child");b.d.up.addClass("ui-first-child")}else{b.d.up.prependTo(b.d.wrap);b.d.down.appendTo(b.d.wrap);b.d.up.addClass("ui-last-child");b.d.down.addClass("ui-first-child")}b.d.wrap.controlgroup();if(h.repButton===false){b.d.up.on(h.clickEvent,function(d){d.preventDefault();b._offset(d.currentTarget,1)});b.d.down.on(h.clickEvent,function(d){d.preventDefault();b._offset(d.currentTarget,-1)})}else{console.log(b.g);b.d.up.on(b.g.eStart,function(d){b.d.input.blur();b._offset(d.currentTarget,1);b.g.move=true;b.g.cnt=0;b.g.delta=1;if(!b.runButton){b.g.target=d.currentTarget;b.runButton=setTimeout(function(){b._sbox_run()},500)}});b.d.down.on(b.g.eStart,function(d){b.d.input.blur();b._offset(d.currentTarget,-1);b.g.move=true;b.g.cnt=0;b.g.delta=-1;if(!b.runButton){b.g.target=d.currentTarget;b.runButton=setTimeout(function(){b._sbox_run()},500)}});b.d.up.on(b.g.eEndA,function(d){if(b.g.move){d.preventDefault();clearTimeout(b.runButton);b.runButton=false;b.g.move=false}});b.d.down.on(b.g.eEndA,function(d){if(b.g.move){d.preventDefault();clearTimeout(b.runButton);b.runButton=false;b.g.move=false}})}if(typeof a.event.special.mousewheel!=="undefined"){b.d.input.on("mousewheel",function(j,k){j.preventDefault();if(!b.disabled){c=parseInt(b.d.input.val(),10)+((k<0)?-1:1);if(c>=h.dmin&&c<=h.dmax){b.d.input.val(c);b.d.input.trigger("change")}}})}},disable:function(){this.d.input.attr("disabled",true);this.d.input.addClass("ui-disabled").blur();this.disabled=true},enable:function(){this.d.input.attr("disabled",false);this.d.input.removeClass("ui-disabled");this.disabled=false}});a(document).bind("pagecreate create",function(b){a(":jqmData(role='spinbox')",b.target).each(function(){var c=typeof(a(this).data("mobile-spinbox"));if(c==="undefined"){a(this).spinbox()}})})})(jQuery);